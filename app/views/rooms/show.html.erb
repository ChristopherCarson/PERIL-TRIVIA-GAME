<% 
@gameStarted = true
@buzzerModalClue = ""
%>

<div class="master" data-channel-subscribe="room" data-room-id="<%= @room.id %>">
<table style="width:100%">
   <tr>
      <th width=20%>
         <h3>
            Game Room: <%= @room.name %>
         </h3>
      </th>
      <th width=20% style="text-align:right;">
         <h3>
            $10,900
         </h3>
      </th>
   </tr>
</table>
<div class="game-board">
   <% if @gameStarted %>
   <table style="width:100%" id="t01">
      <tr>
         <th width=20%><%= $startingBoard[@room.id].categories[0].name %></th>
         <th width=20%><%= $startingBoard[@room.id].categories[1].name %></th>
         <th width=20%><%= $startingBoard[@room.id].categories[2].name %></th>
         <th width=20%><%= $startingBoard[@room.id].categories[3].name %></th>
         <th width=auto><%= $startingBoard[@room.id].categories[4].name %></th>
      </tr>
      <tr>
         <td><button type="button" class='btn btn-primary btn-lg' data-toggle="modal" data-target="#buzzerModal" 
            onClick=<%@buzzerModalClue=$startingBoard[@room.id].categories[0].clues[0].id%>>100</button></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>100<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>100<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>100<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>100<% end %></td>
      </tr>
      <tr>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>200<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>200<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>200<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>200<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>200<% end %></td>
      </tr>
      <tr>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>300<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>300<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>300<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>300<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>300<% end %></td>
      </tr>
      <tr>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>400<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>400<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>400<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>400<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>400<% end %></td>
      </tr>
      <tr>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>500<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>500<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>500<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>500<% end %></td>
         <td><%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-primary btn-lg', remote: true do %>500<% end %></td>
      </tr>
   </table>
   <br/><br/>
   <% else %>
   <div class="chat" data-role="chat">
      <% @room_messages.each do |room_message| %>
      <div class="chat-message-container">
         <div class="row no-gutters">
            <div class="col-auto text-center">
               <img src="<%= room_message.user.avatar_url %>" class="avatar" alt="">
            </div>
            <div class="col">
               <div class="message-content">
                  <p class="mb-1">
                     <%= room_message.message %>
                  </p>
                  <div class="text-right">
                     <small>
                     <%= room_message.created_at %>
                     </small>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <% end %>
   </div>
   <%= simple_form_for @room_message, remote: true do |form| %>
   <div class="input-group mb-3">
      <%= form.input :message, as: :string,
         wrapper: false,
         label: false,
         input_html: {
           class: 'chat-input',
           autocomplete: 'off'
         } %>
      <div class="input-group-append">
         <%= form.submit "Send", class: 'btn btn-primary chat-input' %>
      </div>
   </div>
   <%= form.input :room_id, as: :hidden %>
   <% end %>
</div>
</div>
<div class="d-none" data-role="message-template">
   <div class="chat-message-container">
      <div class="row no-gutters">
         <div class="col-auto text-center">
            <img src="" class="avatar" alt="" data-role="user-avatar">
         </div>
         <div class="col">
            <div class="message-content">
               <p class="mb-1" data-role="message-text">
               </p>
               <div class="text-right">
                  <small data-role="message-date">
                  </small>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>
<% end %>
<table style="width:100%">
   <tr>
      <th width=20%>
         <% if @gameStarted %> 
         <% else %>
         <div style="text-align:left;">
            <%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-success', remote: true do %>
            READY
            <% end %>
         </div>
         <% end %>
      </th>
      <th width=60%>
         <div class="alert alert-success" style="text-align:center; margin: auto;" data-role="display-ready-players">
            <% if @gameStarted %>  
            This is where messages and User input take place.
            <% else %>
            Players Ready:<br/>
            <% if $usersReady[@room.id].present? %>
            <% $usersReady[@room.id].each do |player| %>
            <%= player %><br />
            <% end %> 
            <% end %>
         </div>
         <% end %>         
         </div>
      </th>
      <th width=auto>
         <% if @gameStarted %>  
         <div style="text-align:right;">
            <%= link_to playerReady_rooms_path(:room => @room.id), class: 'btn btn-success', remote: true do %>
            SUBMIT
            <% end %>
         </div>
         <% else %>
         <% end %>
      </th>
   </tr>
</table>
<br/><br/>
<table style="width:60%; text-align:center; margin:auto">
   <tr>
      <th>
         <p>
            <img src="https://api.adorable.io/avatars/40/9ad574806427070b94735f216e9abdc1.png" class="avatar" alt="" data-role="user-avatar">
            SecondPlayer<br/>$1,300
         </p>
      </th>
      <th>
         <p>
            <img src="https://api.adorable.io/avatars/40/cb3cc6699e0fd632910d5a5836d06359.png" class="avatar" alt="" data-role="user-avatar">
            ThirdPlayer<br/>$4,700
         </p>
      </th>
   </tr>
</table>
<br/><br/>
<p data-role="display-raw-data"></p>
<div class="mt-3">
   <%= link_to 'Destroy', @room, :method => :delete, :onclick => "return confirm('Are you sure you want to delete this Game Room?')" %>
</div>

<!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#buzzerModal">Launch demo modal</button>



<!-- Modal -->
<div class="modal fade" id="buzzerModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" data-role="buzzerModal">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="exampleModalLongTitle">flea for $300</h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
        <div class="alert alert-info">
  <strong><%=@buzzerModalClue%></strong>
</div>
      </div>
      <div class="modal-footer">
           <div style="text-align:center;" disabled>
      <%= link_to buzzer_rooms_path(:room => @room.id), class: 'btn btn-danger', remote: true do %>
      BUZZER
      <% end %>
   </div>
      </div>
    </div>
  </div>
</div>

</div>